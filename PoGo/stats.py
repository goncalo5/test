import csv


def get_base_stats(pokemon=""):
    with open('pokemon_list.csv', newline='') as csvfile:
        pokemon_list = csv.DictReader(csvfile, delimiter='\t', quotechar='|')
        for row in pokemon_list:
            # print(row["Pokémon"])
            if row["Pokémon"] and row["Pokémon"].lower() == pokemon.lower():
                res = int(row["Attack"]), int(row["Defense"]), int(row["HP"])
                # print(res)
                return res

level2CPM = {
    1: 0.094,
    1.5: 0.1351374318,
    2: 0.16639787,
    2.5: 0.192650919,
    3: 0.21573247,
    3.5: 0.2365726613,
    4: 0.25572005,
    4.5: 0.2735303812,
    5: 0.29024988,
    5.5: 0.3060573775,
    6: 0.3210876,
    6.5: 0.3354450362,
    7: 0.34921268,
    7.5: 0.3624577511,
    8: 0.3752356,
    8.5: 0.387592416,
    9: 0.39956728,
    9.5: 0.4111935514,
    10: 0.4225,
    10.5: 0.4329264091,
    11: 0.44310755,
    11.5: 0.4530599591,
    12: 0.4627984,
    12.5: 0.472336093,
    13: 0.48168495,
    13.5: 0.4908558003,
    14: 0.49985844,
    14.5: 0.508701765,
    15: 0.51739395,
    15.5: 0.5259425113,
    16: 0.5343543,
    16.5: 0.5426357375,
    17: 0.5507927,
    17.5: 0.5588305862,
    18: 0.5667545,
    18.5: 0.5745691333,
    19: 0.5822789,
    19.5: 0.5898879072,
    20: 0.5974,
    20.5: 0.6048236651,
    21: 0.6121573,
    21.5: 0.6194041216,
    22: 0.6265671,
    22.5: 0.6336491432,
    23: 0.64065295,
    23.5: 0.6475809666,
    24: 0.65443563,
    24.5: 0.6612192524,
    25: 0.667934,
    25.5: 0.6745818959,
    26: 0.6811649,
    26.5: 0.6876849038,
    27: 0.69414365,
    27.5: 0.70054287,
    28: 0.7068842,
    28.5: 0.7131691091,
    29: 0.7193991,
    29.5: 0.7255756136,
    30: 0.7317,
    30.5: 0.7347410093,
    31: 0.7377695,
    31.5: 0.7407855938,
    32: 0.74378943,
    32.5: 0.7467812109,
    33: 0.74976104,
    33.5: 0.7527290867,
    34: 0.7556855,
    34.5: 0.7586303683,
    35: 0.76156384,
    35.5: 0.7644860647,
    36: 0.76739717,
    36.5: 0.7702972656,
    37: 0.7731865,
    37.5: 0.7760649616,
    38: 0.77893275,
    38.5: 0.7817900548,
    39: 0.784637,
    39.5: 0.7874736075,
    40: 0.7903,
    40.5: 0.792803968,
    41: 0.79530001,
    41.5: 0.797800015,
    42: 0.8003,
    42.5: 0.802799995,
    43: 0.8053,
    43.5: 0.8078,
    44: 0.81029999,
    44.5: 0.812799985,
    45: 0.81529999,
    45.5: 0.81779999,
    46: 0.82029999,
    46.5: 0.82279999,
    47: 0.82529999,
    47.5: 0.82779999,
    48: 0.83029999,
    48.5: 0.83279999,
    49: 0.83529999,
    49.5: 0.83779999,
    50: 0.84029999,
    50.5: 0.84279999,
    51: 0.84529999
}

def calc_stats(pokemon="", level=1, ivs=(0,0,0), _round=None):
    # print("level: %s" % level)
    # print("ivs: %s" % str(ivs))
    try:
        ATK, DEF, STA = get_base_stats(pokemon)
    except TypeError:
        return None

    CPM = level2CPM[level]
    # print("CPM: %s" % CPM)
    atk = (ATK + ivs[0]) * CPM
    defense = (DEF + ivs[1]) * CPM
    hp = (STA + ivs[2]) * CPM
    if _round is None:
        return (atk, defense, hp)
    else:
        return (round(atk, _round), round(defense, _round), int(hp))


def calc_stats_product(pokemon="", level=1, ivs=(0,0,0)):
    atk, defense, hp = calc_stats(pokemon, level, ivs, 10)
    # print(atk, defense, hp)
    return round((atk * defense * hp) / 1000, 3)


def calc_cp(pokemon="", level=1, ivs=(0,0,0)):
    atk, defense, hp = calc_stats(pokemon, level, ivs)
    # print(atk, defense, hp)
    cp = (atk * defense**0.5 * hp**0.5) / 10
    return int(cp)